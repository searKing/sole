// Copyright 2021 The searKing Author. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

package sync

import (
	"testing"
)

func TestEventHasFired(t *testing.T) {
	e := NewEvent()
	if e.HasFired() {
		t.Fatal("e.HasFired() = true; want false")
	}
	if !e.Fire() {
		t.Fatal("e.Fire() = false; want true")
	}
	if !e.HasFired() {
		t.Fatal("e.HasFired() = false; want true")
	}
}

func TestEventDoneChannel(t *testing.T) {
	e := NewEvent()
	select {
	case <-e.Done():
		t.Fatal("e.HasFired() = true; want false")
	default:
	}
	if !e.Fire() {
		t.Fatal("e.Fire() = false; want true")
	}
	select {
	case <-e.Done():
	default:
		t.Fatal("e.HasFired() = false; want true")
	}
}

func TestEventMultipleFires(t *testing.T) {
	e := NewEvent()
	if e.HasFired() {
		t.Fatal("e.HasFired() = true; want false")
	}
	if !e.Fire() {
		t.Fatal("e.Fire() = false; want true")
	}
	for i := 0; i < 3; i++ {
		if !e.HasFired() {
			t.Fatal("e.HasFired() = false; want true")
		}
		if e.Fire() {
			t.Fatal("e.Fire() = true; want false")
		}
	}
}
